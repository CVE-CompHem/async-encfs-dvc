+ dvc_stage_name=app_sim_v1_simulation_52
+ dvc_stage_app_yaml=dvc_app.yaml
+ dvc_stage_app_yaml_name=simulation
+ shift 3
+ set +x
slurm_enqueue.sh[app_sim_v1_simulation_52]: Info: Putting any concurrent dvc commit or push operations on hold (use slurm_jobs.sh release later). Warning: Concurrent dvc operations cause a potential conflict for acquiring ../../../../.dvc/tmp/rwlock) and dvc commands (incl. repro) will error out if they detect this.
slurm_enqueue.sh[app_sim_v1_simulation_52]: DVC stage deps of app_sim_v1_simulation_52: ../51/dvc.yaml:app_sim_v1_simulation_51
slurm_enqueue.sh[app_sim_v1_simulation_52]: DVC stage outs of app_sim_v1_simulation_52: output
+ dep_slurm_stage_jobids=()
+ for dep in "${dvc_stage_deps[@]}"
+ log 'Looking for state of DVC dependency ../51/dvc.yaml:app_sim_v1_simulation_51.'
+ echo 'slurm_enqueue.sh[app_sim_v1_simulation_52]: Looking for state of DVC dependency ../51/dvc.yaml:app_sim_v1_simulation_51.'
slurm_enqueue.sh[app_sim_v1_simulation_52]: Looking for state of DVC dependency ../51/dvc.yaml:app_sim_v1_simulation_51.
+++ dvc_yaml_from_dep ../51/dvc.yaml:app_sim_v1_simulation_51
+++ echo ../51/dvc.yaml
++ dirname ../51/dvc.yaml
+ dep_dvc_dir=../51
++ dvc_stage_from_dep ../51/dvc.yaml:app_sim_v1_simulation_51
++ echo app_sim_v1_simulation_51
+ dep_dvc_stage_name=app_sim_v1_simulation_51
++ get_dvc_slurm_job_name ../51/dvc.yaml:app_sim_v1_simulation_51
+++ dvc_stage_from_dep ../51/dvc.yaml:app_sim_v1_simulation_51
+++ echo app_sim_v1_simulation_51
++ echo dvc_app_sim_v1_simulation_51_a6c9254a5c99
+ dep_slurm_stage_name=dvc_app_sim_v1_simulation_51_a6c9254a5c99
++ squeue --name=dvc_app_sim_v1_simulation_51_a6c9254a5c99 --Format=JobID --sort=-S -h
+ dep_slurm_stage_jobid='37962722            '
+ '[' -n '37962722            ' ']'
+ dep_slurm_stage_jobids+=("${dep_slurm_stage_jobid}")
+ '[' 1 -gt 0 ']'
++ printf ,%s '37962722            '
+ dvc_slurm_stage_deps=',37962722            '
+ dvc_slurm_stage_deps='--dependency afterok:37962722            '
++ squeue --name=dvc_app_sim_v1_simulation_52_a6c9254a5c99 --Format=JobID --sort=-S -h
+ stage_jobid=
+ [[ -n '' ]]
+ [[ -f app_sim_v1_simulation_52.dvc_pending ]]
+ [[ -f app_sim_v1_simulation_52.dvc_started ]]
+ '[' -f app_sim_v1_simulation_52.dvc_complete ']'
+ mv ../../../../.dvc/tmp/rwlock ../../../../.dvc/tmp/rwlock.bak
++ dvc status --json app_sim_v1_simulation_52
+ stage_status='{"app_sim_v1_simulation_52": [{"changed deps": {"../51/output": "modified"}}, {"changed outs": {"output": "modified"}}]}'
+ mv ../../../../.dvc/tmp/rwlock.bak ../../../../.dvc/tmp/rwlock
+ [[ {"app_sim_v1_simulation_52": [{"changed deps": {"../51/output": "modified"}}, {"changed outs": {"output": "modified"}}]} == \{\} ]]
+ log 'Cannot find running/committed stage app_sim_v1_simulation_52 - submitting it.'
+ echo 'slurm_enqueue.sh[app_sim_v1_simulation_52]: Cannot find running/committed stage app_sim_v1_simulation_52 - submitting it.'
slurm_enqueue.sh[app_sim_v1_simulation_52]: Cannot find running/committed stage app_sim_v1_simulation_52 - submitting it.
+ run_stage=YES
+ log_submitted_jobs=()
+ [[ YES == \Y\E\S ]]
+ log 'Launching asynchronous stage app_sim_v1_simulation_52 with SLURM'
+ echo 'slurm_enqueue.sh[app_sim_v1_simulation_52]: Launching asynchronous stage app_sim_v1_simulation_52 with SLURM'
slurm_enqueue.sh[app_sim_v1_simulation_52]: Launching asynchronous stage app_sim_v1_simulation_52 with SLURM
+ for out in "${dvc_stage_outs[@]}"
+ ls -I stage_out.log output
+ xargs -I '{}' rm -r 'output/{}'
+ mkdir -p output
+ rm app_sim_v1_simulation_52.dvc_pending app_sim_v1_simulation_52.dvc_started app_sim_v1_simulation_52.dvc_complete app_sim_v1_simulation_52.dvc_failed
rm: cannot remove 'app_sim_v1_simulation_52.dvc_pending': No such file or directory
rm: cannot remove 'app_sim_v1_simulation_52.dvc_started': No such file or directory
rm: cannot remove 'app_sim_v1_simulation_52.dvc_complete': No such file or directory
rm: cannot remove 'app_sim_v1_simulation_52.dvc_failed': No such file or directory
+ true
+ rm 'dvc_sbatch.dvc_commit.*.out' 'dvc_sbatch.dvc_commit.*.err'
rm: cannot remove 'dvc_sbatch.dvc_commit.*.out': No such file or directory
rm: cannot remove 'dvc_sbatch.dvc_commit.*.err': No such file or directory
+ true
+ rm 'dvc_sbatch.dvc_push.*.out' 'dvc_sbatch.dvc_push.*.err'
rm: cannot remove 'dvc_sbatch.dvc_push.*.out': No such file or directory
rm: cannot remove 'dvc_sbatch.dvc_push.*.err': No such file or directory
+ true
+ rm slurm_enqueue_dvc_push_app_sim_v1_simulation_52.sh
rm: cannot remove 'slurm_enqueue_dvc_push_app_sim_v1_simulation_52.sh': No such file or directory
+ true
+ rm 'dvc_sbatch.dvc_cleanup_app_sim_v1_simulation_52_a6c9254a5c99.*.out' 'dvc_sbatch.dvc_cleanup_app_sim_v1_simulation_52_a6c9254a5c99.*.err'
rm: cannot remove 'dvc_sbatch.dvc_cleanup_app_sim_v1_simulation_52_a6c9254a5c99.*.out': No such file or directory
rm: cannot remove 'dvc_sbatch.dvc_cleanup_app_sim_v1_simulation_52_a6c9254a5c99.*.err': No such file or directory
+ true
+++ dirname ../../../../../dvc_tools/slurm_scripts/slurm_enqueue.sh
++ sbatch --parsable --job-name dvc_app_sim_v1_simulation_52_a6c9254a5c99 --dependency afterok:37962722 --account csstaff --nodes 8 --ntasks 16 --cpus-per-task 12 --constraint gpu --time 01:00:00 ../../../../../dvc_tools/slurm_scripts/sbatch_dvc_stage.sh app_sim_v1_simulation_52 sarus run --mount=type=bind,source=/scratch/snx3000/lukasd/mitraccel/castor-dvc-private/data/demo_plain,destination=/app-data --entrypoint bash load/castor-dvc/app_sim -c '/src/app/simulation.sh --simulation-input /app-data/app_sim/v1/simulation/51/output --simulation-output /app-data/app_sim/v1/simulation/52/output --simulation-output-file-num-per-rank 1 --simulation-output-file-size 4000000000'
+ stage_jobid=37962731
+ echo sarus run --mount=type=bind,source=/scratch/snx3000/lukasd/mitraccel/castor-dvc-private/data/demo_plain,destination=/app-data --entrypoint bash load/castor-dvc/app_sim -c '/src/app/simulation.sh --simulation-input /app-data/app_sim/v1/simulation/51/output --simulation-output /app-data/app_sim/v1/simulation/52/output --simulation-output-file-num-per-rank 1 --simulation-output-file-size 4000000000'
+ fsync app_sim_v1_simulation_52.dvc_pending
+ echo 37962731
+ log_submitted_jobs+=("stage: ${stage_jobid}")
+++ dirname ../../../../../dvc_tools/slurm_scripts/slurm_enqueue.sh
++ sbatch --parsable --job-name dvc_cleanup_app_sim_v1_simulation_52_a6c9254a5c99 --dependency afternotok:37962731 --nodes 1 --ntasks 1 --account csstaff --cpus-per-task 24 --constraint mc --time 12:00:00 ../../../../../dvc_tools/slurm_scripts/sbatch_dvc_cleanup.sh app_sim_v1_simulation_52 output
+ cleanup_jobid=37962732
+ echo 37962732
+ log_submitted_jobs+=("cleanup: ${cleanup_jobid}")
+ [[ YES == \Y\E\S ]]
+ '[' -n 37962731 ']'
+ dvc_slurm_commit_deps='--dependency afterok:37962731,singleton'
+++ dirname ../../../../../dvc_tools/slurm_scripts/slurm_enqueue.sh
++ sbatch --parsable --job-name dvc_op_a6c9254a5c99 --dependency afterok:37962731,singleton --nodes 1 --ntasks 1 --account csstaff --cpus-per-task 24 --constraint mc --time 12:00:00 ../../../../../dvc_tools/slurm_scripts/sbatch_dvc_commit.sh app_sim_v1_simulation_52
+ commit_jobid=37962733
+ echo 37962733
+ [[ NO != \Y\E\S ]]
+ scontrol hold 37962733
++ dirname ../../../../../dvc_tools/slurm_scripts/slurm_enqueue.sh
+ log 'Put dvc commit job 37962733 on hold - use '\''scontrol release 37962733'\'' to selectively unblock it or '\''../../../../../dvc_tools/slurm_scripts/slurm_jobs.sh release commit'\'' to unblock all commit jobs.'
+ echo 'slurm_enqueue.sh[app_sim_v1_simulation_52]: Put dvc commit job 37962733 on hold - use '\''scontrol release 37962733'\'' to selectively unblock it or '\''../../../../../dvc_tools/slurm_scripts/slurm_jobs.sh release commit'\'' to unblock all commit jobs.'
slurm_enqueue.sh[app_sim_v1_simulation_52]: Put dvc commit job 37962733 on hold - use 'scontrol release 37962733' to selectively unblock it or '../../../../../dvc_tools/slurm_scripts/slurm_jobs.sh release commit' to unblock all commit jobs.
+ log_submitted_jobs+=("commit: ${commit_jobid} (on hold)")
+ [[ YES == \Y\E\S ]]
+ '[' -n 37962733 ']'
+ dvc_slurm_push_deps='--dependency afterok:37962733,singleton'
+ [[ NO == \Y\E\S ]]
+ push_script=slurm_enqueue_dvc_push_app_sim_v1_simulation_52.sh
++ dirname ../../../../../dvc_tools/slurm_scripts/slurm_enqueue.sh
+ echo '#!/usr/bin/env bash

set -euxo pipefail

cd $(dirname' '$0)
push_jobid=$(sbatch --parsable --job-name dvc_op_a6c9254a5c99 --dependency afterok:37962733,singleton --nodes 1 --ntasks 1 --account csstaff --cpus-per-task 24 --constraint mc --time 12:00:00 ../../../../../dvc_tools/slurm_scripts/sbatch_dvc_push.sh app_sim_v1_simulation_52)
echo ${push_jobid} > app_sim_v1_simulation_52.dvc_push_jobid # useful to figure out which push job (all named equally) commits this stage

'
+ chmod u+x slurm_enqueue_dvc_push_app_sim_v1_simulation_52.sh
+ log 'Submit push job for app_sim_v1_simulation_52 manually with slurm_enqueue_dvc_push_app_sim_v1_simulation_52.sh.'
+ echo 'slurm_enqueue.sh[app_sim_v1_simulation_52]: Submit push job for app_sim_v1_simulation_52 manually with slurm_enqueue_dvc_push_app_sim_v1_simulation_52.sh.'
slurm_enqueue.sh[app_sim_v1_simulation_52]: Submit push job for app_sim_v1_simulation_52 manually with slurm_enqueue_dvc_push_app_sim_v1_simulation_52.sh.
++ printf ', %s' 'stage: 37962731' 'cleanup: 37962732' 'commit: 37962733 (on hold)'
+ log_submitted_jobs=', stage: 37962731, cleanup: 37962732, commit: 37962733 (on hold)'
+ log 'Submitted all jobs for stage app_sim_v1_simulation_52 (stage: 37962731, cleanup: 37962732, commit: 37962733 (on hold)).'
+ echo 'slurm_enqueue.sh[app_sim_v1_simulation_52]: Submitted all jobs for stage app_sim_v1_simulation_52 (stage: 37962731, cleanup: 37962732, commit: 37962733 (on hold)).'
slurm_enqueue.sh[app_sim_v1_simulation_52]: Submitted all jobs for stage app_sim_v1_simulation_52 (stage: 37962731, cleanup: 37962732, commit: 37962733 (on hold)).
